# daily-work-log

### 2025-09-11 목요일
- [X] 피드백 반영해 보고서 수정
- [X] 주간 업무 보고 (서면 제출)
- [X] GPU 서버 지원 신청서 작성
- 경인일보 인사이트브리핑:
  - [X] 마인드맵, 브리핑에 사용된 관련기사 기능 있는 버전 공유
  - [ ] 전 과정의 입출력 결과 JSON 파일에 저장되도록 수정 (완료하지 못해서 내일 재시도)
- [X] 내일 멘토링 설명 준비

### 2025-09-12 금요일
- 경인일보:
  - [X] DB 관련 설정 변경해서 존재하는 기사 못 가져오는 이슈 해결
  - [X] 키워드 정제 관련 프롬프트 수정
 
### 2025-09-13 토요일
- 경인일보:
  - [X] 다양한 사용자 요구 처리할 방법 마련

### 2025-09-26 금요일
- 경인일보:
  - [X] 2번째 대여서버 세팅, 1번째 대여서버 putty로 용량 정리
  - [X] pydantic 학습 1시간
  - [X] vllm(kanana 2.1b)+hcx 기반 백엔드 개발 (쿼리 정제)
 
- 실험

### 2025-09-27 토요일
- 경인일보:
  - [X] nginx+fastapi서버+ssh터널링으로 용량 변화 없이 원격 서버의 벡터DB, JSON파일 접근 및 검색 구현
  - [X] briefing_db 함수 호출하면 쿼리 분석해서 keyword, startdate, enddate 추출하고 요약 (기사는 리스트에 하드코딩해서 테스트만)
  - [X] kanana에게 요약문 3개 주고 종합브리핑 시켰는데 결과 매우 좋음
 
- 실험

### 2025-09-28 일요일
- 경인일보:
  - [X] 전체 태스크의 최대 토큰 수 파악, 해당 설정 포함해 vllm serve 설정
  - [X] 코드 최적화
  - [X] kanana로 추천검색어 생성하기 위한 프롬프트 실험
- 실험

### 2025-09-29 월요일
- 경인일보:
  - [X] kanana 이용한 추천검색어, 마인드맵 생성 프롬프트 완성
  - [X] 서버 동시사용 테스트 (locust) (l4 gpu2장 20명까지)
  - [X] vllm을 systemd로 백그라운드 실행

### 2025-09-30 화요일
- 수업 조교
- 경인일보:
  - [X] 유사도 검색 성능 향상 방법 학습
  - [X] query 필터링 태스크에 대해 kanana 성능 평가
- 실험

### 2025-10-01 수요일
- 실험
  - [X] 작은 태스크 하나에 대해 kanana 프롬프트 200번 이상 수정, 약 30% → 99.5%로 정확도 향상
- 경인일보
  - [X] 전체 프로세스 다시 만들고 백엔드 개발 진행
 
### 2025-10-02 목요일
- 주간 업무 보고
- 실험
  - [X] 카나나 프롬프팅, 어제 경험도 있고 더 쉬운 태스크들이어서 4가지 모두 90% 이상 (91, 06, 06, 100) 달성
  - [X] 어제 태스크는 정답 데이터가 문제였다. 100% 달성.
    * 다만 데이터가 작아 간단한 테스트일 뿐이다. 더 늘려서 다시 테스트할 필요 있음
- 경인일보
  - [X] 도커 빌드
  - [X] 백엔드 개발 계속

### 2025-10-03 금요일
- 경인일보
  - [X] 풀스택 개발: PV기사 조회(사용자가 1, 3, 7, 30일 중 택1), 검색어 입력 시 함수 호출(정말 늦어도 2초 안에 나옴)
  - [X] 각 파이프라인의 과정이 서로 다른 위치에 곧바로 출력되도록 방법 서치
- 실험

### 10.20 월
- [X] 텔레그램에서 최근에 나온 경인일보 api를 관련기사 기능에 적용  
==> 유사도 검색이 아님 ('인천에 대해 브리핑'이라는 요구사항에 대해 다른 대답이 나오게 됨. 의도는 인천이라는 도시에 대한 설명이 나오는 건데 정확도, 최신 기준으로 검색하면 인천 자체보다는 구체적인 사건 관련 설명 위주로 나옴)  
==> 서울시스템 서버 내 기능을 기반으로 하되 경인일보 서버 내에 구현해두어서 서울시스템 서버에서 제공 못할 경우 대비  
==> 일단 서울시스템에 구현한 상태 유지  
- [X] AI 작동과정 문구 수정 (기독교뉴스 ai 서비스 참고)
- [X] 키워드를 처리하는 경우들 정리해서 공유 (구분값을 분기별로 정확하게 알려드려야)
- [X] html에서 도메인으로 변경 (html에서 const WS_URL = `ws://4[MASK]8:8000/ws/${sessionId}`; 를 --> const WS_URL = `wss://s[MASK]m/ws/${sessionId}`; 로 바꾸고 const API_URL = 'http://4[MASK]8:8000'; 를 --> const API_URL = `https://s[MASK]m`; 로 바꿈)
- [X] 15명부터는 '간단한 답변' 기능만 사용할 수 있게 하기 (briefing_sessions에 briefing으로 시작하는 기능 사용하는 세션 관리. 15개부터는 단순 답변 기능만 쓸 수 있게) (브리핑 사용하는 세션이 13명 이하로 떨어지기 전까지는 instead_of_briefing.py 과 담소..)
==> 코드로 구현은 했는데 테스트 안해봄. 서비스 테스트할 때 구현 여부 확인. 문제되면 수정.  

### 10.21 화
- [X] ky db에 쏘고 있는 ky_news를 서울시스템 서버로 (경로 전달드리기) 쏴달라고 요청 ==> 경로 보내드리기
- [X] LLM START/END --> 요약은 SUMMARY_START/END, 브리핑은 BREIFING_START/END
- [X] 추천검색어 나오게 하기: 리스트 형식
- [X] 추천검색어, 관련기사 관련 타입명도 수정 (백엔드, 프론트엔드 둘 다)

### 10.22 수
- [X] 오타 정정 빼고, 욕설/의미없는말/오타 인 경우 모두 팝업만 나오게
- [X] AI 작동 과정에 있는 문구 줄이고 더 자연스러운 표현으로 수정
- [X] 타입 수정
- [X] 이슈4: 서비스 시작, 끝 타입 전달되게
- [X] 이슈 3: db 브리핑 덜 끝난 상태에서 화면 꺼도 백그라운드 실행됨. 화면 끄거나 새로고침하면 초기화되게 수정
- [X] 이슈 5: 규칙기반으로 재입력 요구하는 경우도 다른 경우와 통일

### 10.23 목
- [X] DB 수정
	- [X] (timestamp DB) 기존 DB에 timestamp처럼 mainthumbnailUrl 메타데이터 추가 (확인도 함. )
	- [X] 요약, 관련기사에 이미지 링크 전달되도록 코드 수정
	- [X] (위 작업 완료된 상태의 timestamp DB 사본) 제목에 '[포토]', '[화보]' 포함 무의미한 내용인 기사 DB에서 전부 삭제하기 (json과 db 모두) (제외 패턴: 포토, 경인만평 이공명, 김상돈의 인물세평, content=="")
- [X] 이슈 1: vLLM 캐시 때문에 이전에 출력했던 키워드를 출력하는 경우 있음. 주로 한두 글자짜리이므로 len(query) < len(keyword) 인 경우 웹서치로 전환 (짧으니까 query 그대로 웹서치에 사용할 예정)
- [X] 타입 수정
- [X] 요약용 기사 날짜순 정렬

### 10.24 금
- [X] 타입 수정
- [X] 상황별 문구 수정
	- [X] 서버 관련 오류인 경우와 사용자 검색어가 문제인 경우
	- [X] 욕설, 의미없는내용 문구 --> 입력하신 내용을 이해할 수 없습니다. 다시 입력해주세요 로 수정.
- [X] 요약 단계 개선 (마크다운에 1회성 저장. logger 안되고 나중에 보수 쉽게 하기 좋아서.)

### 10.25 토
- [X] 검색어 추천 LLM으로 전환

### 10.26 일
- [X] 데이터셋 일부 제작

### 10.27 월
- [X] 이슈 2: 날짜 없는데 0000.12.31??부터 2025.1.1까지로 나옴 ==> where_or_not에서 "Print False if not"을 "Print False if there is no mention about date at all."로 고침. 테스트해본 경우의 수가 다 인천이어서 다른 쿼리들은 다 날짜가 있는 걸로 인식하고 있었음
- [X] 소제목 관련 수정하기
- [X] 모델 학습

### 밤샘(배포)
- [X] 요약 태스크 학습시킨 모델 올리기 (할루시네이션 방지+키워드 소제목+3문장 이내+일정한 형식)
- [X] 최신 기사 뉴스 DB 따로 구축, 우선적으로 내용 가져오게 하기
- [X] 브리핑 관련 수정
- [X] 앞에 나오는 (김동연-, 역대-, 수도권 매립지-) 질의 다 나오게 하기 (역대-는 차차 수정)
- [X] (개수는 다 가리기) 15개 찾았습니다 --> 찾았습니다
- [X] 문구 변경
- [X] 브리핑 2단락+소제목 나오게 --> summarizer 활용
- [X] 활용 기능 정리해서 공유드림
- [X] 브리핑 제목 추가 (요약 제목이랑 똑같이)

### 10.29 수
- [X] 브리핑 제목+본문 프론트 위해 id 설정
- [X] 오픈소스 모델 관련 설명 추가해서 문서 다시 전달
- [X] 로그 기록 안되는 이유 찾기 ==> main.py 파일 고치고 sudo systemctl restart backend 안하면 그렇다
- [X] 로그에 질문마다 [LLM_USAGE]가 logger로 찍히게 하고, backend.log 경로와 ip(연구실, 집 ==> 4[MASK]8, 1[MASK]9) 보내드리기
- [X] 깃허브 브랜치 생성(k-backend-dev)
- [X] process가 OPTIONS 메소드로 전달되는데 이걸 클라우드에서 막아서 llm이 동작하지 않음. 예외처리 요청 했으나 백엔드 상에서 원인 찾기 ==> 백엔드에서는 process가 post로 정의되어 있음. 데모 사이트를 사용해서 백엔드 로그를 보면 POST로 되어 있는 것도 확인됨. 프론트 문제였음

### 10.30 목
- [X] 4090에서 개발용으로 서빙 (ip 설정 수정, stg-backend와 vllm 띄우기)
- [X] 유사도 점수 판단 기능 추가
- [X] 브리핑 두 단락으로 나오게 (형식, 내용 주의)
- [X] 개발용 벡터DB 하나 더 만들기 (이름에 dev 붙이기) ==> 그냥 kyeongin_db_api 폴더 복붙해서 kyeongin_db_api_db로
- [X] kyeongin_db_api_db의 api 따로 띄우기 ==> db_mode 0, 1 같이 쓰는 걸로 함
- [X] 내일 시연 준비 (위에 한 거 포함 자잘한 수정, 운영서버 변경)

### 10.31 금
- [X] 시연 준비 (특정 검색어 결과 나오도록 p_1, p_2 수정하고 해당 코드 # 시연용 이라고 표시, 경어체로 통일되도록 로직 개선)
- [X] 현재 운영서버 다시 가져오고 (개발서버에 있는 것 중 main과 html만 남기기, api, ws, ip 참고해야 함) 경로 하드코딩을 os로 변경
- [X] 경인일보 홈페이지에는 '이춘재’ 결과가 많이 나오는데 DB에는 해당 기사들이 전혀 안 나오는 원인 찾기 (데이터 미제공인지 DB 문제인지) ==> DB 문제..

### 11.1 토
- [X] GraphRAG 사용 시도, 벡터DB 관련 리서치

### 11.2 일
- [X] 벡터DB 관련 리서치
- [X] graphrag 사용 시도 (이슈: index 명령어 실행 도중 중단(매우 오래 걸림) / deprecated 모델 사용(4-turbo-preview))
- [X] 단일 DB 만들기

### 2025-11-03 월
- [X] 서버 인식해서 조건문 (`if ENVIRONMENT == "development":`, `else`) 인식되게 하기. 기본값은 `ENVIRONMENT = os.getenv("ENVIRONMENT", "development")` 코드로 인해 development가 됨. 환경 변수에 별도로 명시되지 않을 경우 development로 정한다는 의미의 코드임. service 스크립트에 `Environment=ENVIRONMENT=production` 추가하면 production으로 인식되고, CORS_ORIGINS를 `"https://k-insight.kyeongin.com/"`로 해야 함.
- [X] "https://stg-www.kyeongin.com/" (demo 말고 운영과 동일하게) 으로 접속 및 사용되게 하기
- [X] 도메인 4개 설정 (즉시 반영)
- [X] 로그 한달 단위로 백업 및 backend.log 초기화되게 구현 (log rotation) (1107 금요일 반영 예정) (pip install pandas openpyxl apscheduler 해야 함)
- [X] 매일 17시-다음날17시 로그 기반 엑셀 파일 자동 생성 코드 추가 (1107 금요일 반영 예정)
- [X] 엑셀에 저장되는 내용 조정 (1107 금요일 반영 예정)
- [X] 경기도뉴스API 추가 시도..

### 11.4 화
