# daily-work-log

### 11.30 일
- [X] finished the resume draft and submitted it for feedback
- [X] sent a Rebellion NPU pricing inqury email
- [X] moved new DB to SSC server to use it as the related-news API for the stg backend (via scp command)
- [X] copied the entire prod server's backend to stg server(rtx4090), reviewed the differences, and created a checklist for seamlessly switching the stg backend to the prod asap (only the `app` & `_test` folder need to be replaced, **must add an related-news API configuration in the domain code, which switches based on the server environment)**)
- [X] replaced the vLLM-based backend with the GPT-based backend in stg server (**some issues remain - summaries are not appearing, fix it tomorrow**)

### 11.29 토
- [X] 러닝스푼즈 1회차 학습 (3시간)

### 11.28 금
- [X] 그래프 전달
- [X] 6018 이슈 해결..갑자기 중간부터 결과 안 나옴 근데 4090 용량 때문에 계속 접속 안됨 5090도 용량 때문에 자주 끊김 putty로 접속했는데 이렇게 느리게 반응하는 거 처음 본다 `sudo du -h --max-depth=1 /home | sore -hr`
- [X] 6018에서 질의 분석 단계 수정 (정해진 형식에 따라 print문을 작성하면 된다)
- [X] 요약, 브리핑 수정 (형식과 내용 의도한 대로 나오도록 프롬프팅)
- [X] 리드문(lead_paragraph)은 경인일보와 공공기관 출처에서만 리서치 + 출처 표기 나오게 수정 (답변할 때 도메인 접속에 실패하는 경우가 있어서 그럴 때는 지정된 문구 출력하도록 코드기반 처리)
- [X] 마인드맵 추가 (어렵다) (화면에 공간도 없고 기존에 텍스트 출력하는 섹션에 추가하려니 AI들이 혼미해져서 버튼 클릭하면 팝업 나오게 함)
- [X] 업데이트 사항(리드문, 마인드맵, 브리핑 고도화) 보고드리기
- [X] 어색한 부분 발견, 추가 수정
- [X] 마인드맵 아이디어 제공 겸 디자인 추가 수정 (바이브코딩)
- [X] 새 벡터 DB에 대한 fastapi 코드 작성해서 결과 나오게 해보기 (기존 api 코드 참고)

### 11.27 목
- [X] 관련기사 api 관련해 상황 파악, 5090에 있는 관련 데이터 전부 삭제
- [X] putty로 4090 용량 정리..
- 소장님의 멘토링: 개발 진행상황 직접 관련 실무진 분들한테 전달 필요, 연구노트를 위한 구성도 전달, 리드문은 출처 경인일보/공공기관 100% 되게 튜닝해야 운영 적용 가능, 클라이언트가 '~ 시간대에 운영 반영해달라’라고 할 수 있으려면 stg 서버의 수정사항이 운영에 반영되는 데 소요되는 시간을 말씀드려야 함. 반영했다 오류나는 경우 대비해야 하기 때문.
- [X] 로그 분석 결과 엑셀 파일 자동 생성용 코드 구현 (수동으로 작성해야 하는 내용(오류 원인과 해결 방안)을 제외하고 전부 자동화, 그래프 그리는 부분 추가) + 오픈부터 현재까지 사용통계 그래프 이미지 전달드리기 ==> 있어빌리티하려면 수정 필요. 일단은 수동으로 파일 수정 후 보고하고 이어서 코드 수정하기로
- [X] 증빙용 그래프 완성하기 (내일 전달)

---

### 2025-09-11 목요일
- [X] 피드백 반영해 보고서 수정
- [X] 주간 업무 보고 (서면 제출)
- [X] GPU 서버 지원 신청서 작성
- 경인일보 인사이트브리핑:
  - [X] 마인드맵, 브리핑에 사용된 관련기사 기능 있는 버전 공유
- [X] 내일 멘토링 설명 준비

<br>

### 2025-09-12 금요일
- 경인일보:
  - [X] DB 관련 설정 변경해서 존재하는 기사 못 가져오는 이슈 해결
  - [X] 키워드 정제 관련 프롬프트 수정
 
<br>

### 2025-09-13 토요일
- 경인일보:
  - [X] 다양한 사용자 요구 처리할 방법 마련

<br>

### 2025-09-26 금요일
- 경인일보:
  - [X] 2번째 대여서버 세팅, 1번째 대여서버 putty로 용량 정리
  - [X] pydantic 학습 1시간
  - [X] vllm(kanana 2.1b)+hcx 기반 백엔드 개발 (쿼리 정제)

<br>

### 2025-09-27 토요일
- 경인일보:
  - [X] nginx+fastapi서버+ssh터널링으로 용량 변화 없이 원격 서버의 벡터DB, JSON파일 접근 및 검색 구현
  - [X] briefing_db 함수 호출하면 쿼리 분석해서 keyword, startdate, enddate 추출하고 요약 (기사는 리스트에 하드코딩해서 테스트만)
  - [X] kanana에게 요약문 3개 주고 종합브리핑 시켰는데 결과 매우 좋음
 

<br>


### 2025-09-28 일요일
- 경인일보:
  - [X] 전체 태스크의 최대 토큰 수 파악, 해당 설정 포함해 vllm serve 설정
  - [X] 코드 최적화
  - [X] kanana로 추천검색어 생성하기 위한 프롬프트 실험

<br>

### 2025-09-29 월요일
- 경인일보:
  - [X] kanana 이용한 추천검색어, 마인드맵 생성 프롬프트 완성
  - [X] 서버 동시사용 테스트 (locust) (l4 gpu2장 20명까지)
  - [X] vllm을 systemd로 백그라운드 실행

<br>

### 2025-09-30 화요일
- 수업 조교
- 경인일보:
  - [X] 유사도 검색 성능 향상 방법 학습
  - [X] query 필터링 태스크에 대해 kanana 성능 평가

<br>

### 2025-10-01 수요일
- 실험
  - [X] 작은 태스크 하나에 대해 kanana 프롬프트 200번 이상 수정, 약 30% → 99.5%로 정확도 향상
- 경인일보
  - [X] 전체 프로세스 다시 만들고 백엔드 개발 진행
 
<br>

### 2025-10-02 목요일
- 주간 업무 보고
- 실험
  - [X] 카나나 프롬프팅, 어제 경험도 있고 더 쉬운 태스크들이어서 4가지 모두 90% 이상 (91, 06, 06, 100) 달성
  - [X] 어제 태스크는 정답 데이터가 문제였다. 100% 달성.
    * 다만 데이터가 작아 간단한 테스트일 뿐이다. 더 늘려서 다시 테스트할 필요 있음
- 경인일보
  - [X] 도커 빌드
  - [X] 백엔드 개발 계속

<br>

### 2025-10-03 금요일
- 경인일보
  - [X] 풀스택 개발: PV기사 조회(사용자가 1, 3, 7, 30일 중 택1), 검색어 입력 시 함수 호출(정말 늦어도 2초 안에 나옴)
  - [X] 각 파이프라인의 과정이 서로 다른 위치에 곧바로 출력되도록 방법 서치

<br>

### 10.20 월
- [X] 텔레그램에서 최근에 나온 경인일보 api를 관련기사 기능에 적용  
==> 유사도 검색이 아님 ('인천에 대해 브리핑'이라는 요구사항에 대해 다른 대답이 나오게 됨. 의도는 인천이라는 도시에 대한 설명이 나오는 건데 정확도, 최신 기준으로 검색하면 인천 자체보다는 구체적인 사건 관련 설명 위주로 나옴)  
==> 서울시스템 서버 내 기능을 기반으로 하되 경인일보 서버 내에 구현해두어서 서울시스템 서버에서 제공 못할 경우 대비  
==> 일단 서울시스템에 구현한 상태 유지  
- [X] AI 작동과정 문구 수정 (기독교뉴스 ai 서비스 참고)
- [X] 키워드를 처리하는 경우들 정리해서 공유 (구분값을 분기별로 정확하게 알려드려야)
- [X] html에서 도메인으로 변경 (html에서 const WS_URL = `ws://4[MASK]8:8000/ws/${sessionId}`; 를 --> const WS_URL = `wss://s[MASK]m/ws/${sessionId}`; 로 바꾸고 const API_URL = 'http://4[MASK]8:8000'; 를 --> const API_URL = `https://s[MASK]m`; 로 바꿈)
- [X] 15명부터는 '간단한 답변' 기능만 사용할 수 있게 하기 (briefing_sessions에 briefing으로 시작하는 기능 사용하는 세션 관리. 15개부터는 단순 답변 기능만 쓸 수 있게) (브리핑 사용하는 세션이 13명 이하로 떨어지기 전까지는 instead_of_briefing.py 과 담소..)
==> 코드로 구현은 했는데 테스트 안해봄. 서비스 테스트할 때 구현 여부 확인. 문제되면 수정.  

<br>

### 10.21 화
- [X] ky db에 쏘고 있는 ky_news를 서울시스템 서버로 (경로 전달드리기) 쏴달라고 요청 ==> 경로 보내드리기
- [X] LLM START/END --> 요약은 SUMMARY_START/END, 브리핑은 BREIFING_START/END
- [X] 추천검색어 나오게 하기: 리스트 형식
- [X] 추천검색어, 관련기사 관련 타입명도 수정 (백엔드, 프론트엔드 둘 다)

<br>

### 10.22 수
- [X] 오타 정정 빼고, 욕설/의미없는말/오타 인 경우 모두 팝업만 나오게
- [X] AI 작동 과정에 있는 문구 줄이고 더 자연스러운 표현으로 수정
- [X] 타입 수정
- [X] 이슈4: 서비스 시작, 끝 타입 전달되게
- [X] 이슈 3: db 브리핑 덜 끝난 상태에서 화면 꺼도 백그라운드 실행됨. 화면 끄거나 새로고침하면 초기화되게 수정
- [X] 이슈 5: 규칙기반으로 재입력 요구하는 경우도 다른 경우와 통일

<br>

### 10.23 목
- [X] DB 수정
	- [X] (timestamp DB) 기존 DB에 timestamp처럼 mainthumbnailUrl 메타데이터 추가 (확인도 함. )
	- [X] 요약, 관련기사에 이미지 링크 전달되도록 코드 수정
	- [X] (위 작업 완료된 상태의 timestamp DB 사본) 제목에 '[포토]', '[화보]' 포함 무의미한 내용인 기사 DB에서 전부 삭제하기 (json과 db 모두) (제외 패턴: 포토, 경인만평 이공명, 김상돈의 인물세평, content=="")
- [X] 이슈 1: vLLM 캐시 때문에 이전에 출력했던 키워드를 출력하는 경우 있음. 주로 한두 글자짜리이므로 len(query) < len(keyword) 인 경우 웹서치로 전환 (짧으니까 query 그대로 웹서치에 사용할 예정)
- [X] 타입 수정
- [X] 요약용 기사 날짜순 정렬

<br>

### 10.24 금
- [X] 타입 수정
- [X] 상황별 문구 수정
	- [X] 서버 관련 오류인 경우와 사용자 검색어가 문제인 경우
	- [X] 욕설, 의미없는내용 문구 --> 입력하신 내용을 이해할 수 없습니다. 다시 입력해주세요 로 수정.
- [X] 요약 단계 개선 (마크다운에 1회성 저장. logger 안되고 나중에 보수 쉽게 하기 좋아서.)

<br>

### 10.25 토
- [X] 검색어 추천 LLM으로 전환

<br>

### 10.26 일
- [X] 데이터셋 일부 제작

<br>

### 10.27 월
- [X] 이슈 2: 날짜 없는데 0000.12.31??부터 2025.1.1까지로 나옴 ==> where_or_not에서 "Print False if not"을 "Print False if there is no mention about date at all."로 고침. 테스트해본 경우의 수가 다 인천이어서 다른 쿼리들은 다 날짜가 있는 걸로 인식하고 있었음
- [X] 소제목 관련 수정하기
- [X] 모델 학습

<br>

### 밤샘(배포)
- [X] 요약 태스크 학습시킨 모델 올리기 (할루시네이션 방지+키워드 소제목+3문장 이내+일정한 형식)
- [X] 최신 기사 뉴스 DB 따로 구축, 우선적으로 내용 가져오게 하기
- [X] 브리핑 관련 수정
- [X] 앞에 나오는 (김동연-, 역대-, 수도권 매립지-) 질의 다 나오게 하기 (역대-는 차차 수정)
- [X] (개수는 다 가리기) 15개 찾았습니다 --> 찾았습니다
- [X] 문구 변경
- [X] 브리핑 2단락+소제목 나오게 --> summarizer 활용
- [X] 활용 기능 정리해서 공유드림
- [X] 브리핑 제목 추가 (요약 제목이랑 똑같이)

<br>

### 10.29 수
- [X] 브리핑 제목+본문 프론트 위해 id 설정
- [X] 오픈소스 모델 관련 설명 추가해서 문서 다시 전달
- [X] 로그 기록 안되는 이유 찾기 ==> main.py 파일 고치고 sudo systemctl restart backend 안하면 그렇다
- [X] 로그에 질문마다 [LLM_USAGE]가 logger로 찍히게 하고, backend.log 경로와 ip(연구실, 집 ==> 4[MASK]8, 1[MASK]9) 보내드리기
- [X] 깃허브 브랜치 생성(k-backend-dev)
- [X] process가 OPTIONS 메소드로 전달되는데 이걸 클라우드에서 막아서 llm이 동작하지 않음. 예외처리 요청 했으나 백엔드 상에서 원인 찾기 ==> 백엔드에서는 process가 post로 정의되어 있음. 데모 사이트를 사용해서 백엔드 로그를 보면 POST로 되어 있는 것도 확인됨. 프론트 문제였음

<br>

### 10.30 목
- [X] 4090에서 개발용으로 서빙 (ip 설정 수정, stg-backend와 vllm 띄우기)
- [X] 유사도 점수 판단 기능 추가
- [X] 브리핑 두 단락으로 나오게 (형식, 내용 주의)
- [X] 개발용 벡터DB 하나 더 만들기 (이름에 dev 붙이기) ==> 그냥 kyeongin_db_api 폴더 복붙해서 kyeongin_db_api_db로
- [X] kyeongin_db_api_db의 api 따로 띄우기 ==> db_mode 0, 1 같이 쓰는 걸로 함
- [X] 내일 시연 준비 (위에 한 거 포함 자잘한 수정, 운영서버 변경)

<br>

### 10.31 금
- [X] 시연 준비 (특정 검색어 결과 나오도록 p_1, p_2 수정하고 해당 코드 # 시연용 이라고 표시, 경어체로 통일되도록 로직 개선)
- [X] 현재 운영서버 다시 가져오고 (개발서버에 있는 것 중 main과 html만 남기기, api, ws, ip 참고해야 함) 경로 하드코딩을 os로 변경
- [X] 경인일보 홈페이지에는 '이춘재’ 결과가 많이 나오는데 DB에는 해당 기사들이 전혀 안 나오는 원인 찾기 (데이터 미제공인지 DB 문제인지) ==> DB 문제..

<br>

### 11.1 토
- [X] GraphRAG 사용 시도, 벡터DB 관련 리서치

<br>

### 11.2 일
- [X] 벡터DB 관련 리서치
- [X] graphrag 사용 시도 (이슈: index 명령어 실행 도중 중단(매우 오래 걸림) / deprecated 모델 사용(4-turbo-preview))
- [X] 단일 DB 만들기

<br>

### 2025-11-03 월
- [X] 서버 인식해서 조건문 (`if ENVIRONMENT == "development":`, `else`) 인식되게 하기. 기본값은 `ENVIRONMENT = os.getenv("ENVIRONMENT", "development")` 코드로 인해 development가 됨. 환경 변수에 별도로 명시되지 않을 경우 development로 정한다는 의미의 코드임. service 스크립트에 `Environment=ENVIRONMENT=production` 추가하면 production으로 인식되고, CORS_ORIGINS를 `"https://k-insight.kyeongin.com/"`로 해야 함.
- [X] "https://stg---.com/" (demo 말고 운영과 동일하게) 으로 접속 및 사용되게 하기
- [X] 도메인 4개 설정 (즉시 반영)
- [X] 로그 한달 단위로 백업 및 backend.log 초기화되게 구현 (log rotation) (1107 금요일 반영 예정) (pip install pandas openpyxl apscheduler 해야 함)
- [X] 매일 17시-다음날17시 로그 기반 엑셀 파일 자동 생성 코드 추가 (1107 금요일 반영 예정)
- [X] 엑셀에 저장되는 내용 조정 (1107 금요일 반영 예정)
- [X] 경기도뉴스API 추가 시도..

<br>

### 11.4 화
- [X] 경기도뉴스포털 api 사용 시도
- [X] 조교
- [X] 퓨처누리 회의 (업무 배정받고 vpn 연결, airflow와 postgresql 스터디)
- [X] 캡처화면 보내드리기
   - [X] 서본결 구조 브리핑 관련 코드
   - [X] tool calling 설계(질의 의도 분석 및 각 기능 실행) 관련 코드
   - [X] pv 관련 코드
   - [X] db api, 경기도뉴스포털 api 활용 코드
- [X] 새로 들어온 기사들로 벡터DB 만들건데 timestamp 추가되게 하기 --> JSON 파일 형식 맞춰서 일단 수정, 노헙으로 돌리면서 로그 저장되게 한 상태. 벡터화 완료되었을 때 DB 검색 어떻게 되는지 확인 필요 (timestamp 메타데이터 추가하는 코드 추가, JSON 내부 구조(2가지..item 키에 있는 딕셔너리와 그냥 딕셔너리))

<br>

### 11.05 수요일
- [X] searxng 사용법 파악 (config에서 json, get으로 설정해야 사용하기 수월)
- [X] 경기도뉴스포털 API 이슈 해결 시도, 문의
- [X] 회의하면서 개발한 거 증명(?), 나머지 증빙할 자료 파악
- [X] 같은 DB 2개 만들었다.. 폴더 정확하게 설정해서 최근 기사 벡터DB 만들기
- [X] 경기도뉴스포털api 안되는 이유 파악, 메일 답장드리기 (다양한 에러 잘 반환됨. 코드 상으로는 문제 없어보임)
- [X] 퓨처누리 VPN 연결 및 서버 접속
- [X] 4090 용량 정리..(VSCode 접속 안되서 putty 사용)
- [X] 에어플로우(패캠) 학습

<br>

### 11.6 목
- 중요: 11.12수 오후 4시까지 지원사업결과보고서 할당량+경기도뉴스포털반영+PV반영+searxng웹서치기능 끝내고 보고, 11.17월 오전 중에 GPT 기반 K-인사이트 프로토타입(백엔드 새로 개발하고 속도비용성능 고려해 모델 선정)과 구매할 API 안내드리기
- [X] 오전 11시 대화지능연구팀 회의 참여, 업무 배정받기
- [X] 경기도뉴스포털 관련 메일 (결론: 등록 api, 조회 api 따로 있고 발급받은 api는 등록 api였다. (코드 돌린 적 있는데 설마 올린 거 있는지 확인해보기) 그래서 경인일보에서 조회 api 요청드려달라고 부탁드린 상태)
- [X] k-인사이트 현재 구성도 그려서 지원사업 결과보고서에 넣기
- [X] 지원사업 결과보고서 수정
- [X] 핸즈온 LLM 읽기 (조금 읽고 조금 외움)

<br>

### 11.7 금
- [X] 개발지원사업 보고서 추가수정, 보고
- [X] 경기도뉴스포털 조회 API 받음 --> 기사 링크 통해서 본문 크롤링, 관련기사 요약에 적용되도록 구현 (업무시간 내에 개발서버 백엔드 적용 및 보고)

<br>

### 11.8 토
- [X] DAG 생성
- [X] airflow 스터디
- [X] 핸즈온 LLM 공부

<br>

### 11.9 일

<br>

### 11.10 월
- [X] OpenAI API 구매 절차 및 설정 정리해서 보내드리기
- [X] 관련기사 타입 설정 (별도의 섹션에 나오게)
- [X] 퓨처누리 인스트럭션 자동 생성 DAG 개선 (Structured Output JSON 출력 강화, gpt api로 이미지의 텍스트 추출)

<br>

### 11.11화
- [X] 한 일 X / 주간보고용 기록 O --> 경인일보에서 발급해주신 openai api key 사용
- [X] 조교
- [X] s[MASK]m 에(운영되는 모습) 브리핑이 gpt로 3문단(서론 본론 결론) 나오게
- [X] 한 일 명확하게 정리해서 전달드리기
- [X] 모델 평가 코드 일부 작성

<br>

### 11.12 수
- [X] 요구사항정의서및추적표 엑셀 파일의 '요구사항 상세내용’ 기반 캡처본 정리 (마인드맵만 별도로 예전 시연 모습에서 캡처)

<br>

### 11.13 목
- [X] 전체회의, 회식참여
- [X] 운영 시작일인 10월 25일부터 11월 12일 16:59까지 사용자 검색어와 에러 발생한 경우, 에러 발생 원인 등 엑셀에 정리해서 보고
- [X] DeepLearning.AI PyTorch for Deep Learning의 PyTorch: Fundamentals 20% 이상 수강

<br>

### 11.14 금
- [X] GPT 기반 백엔드 개발 시작
- [X] GPU 설치된 후 vllm과 stg-backend 다시 띄우기(가상환경에 paddleocr paddlepaddle paddlex 설치했는데 vllm이랑 의존성 충돌 나서 지움), vllm 테스트용 gpu 하나 선점..vllm 띄워놓고 수시로 프롬프팅 등으로 테스트
- [X] 2b 미만 모델 테스트: hcx 0.5b (private repo의 리드미에 기록함)
- [X] 파이토치 스터디 1시간

<br>

### 11.15 토
- [X] 오프라인 실습 6시간
- [X] CUDA 버전 업그레이드 해서 5090에서 드디어 vLLM 사용 가능. 연구실 단톡에 알리고 사용법 정리해서 공유함

<br>

### 11.16 일
- [X] 오프라인 실습 6시간

<br>

### 11.17-21 월-금
- [X] 벡터DB 개선, 백엔드 개발, 퓨쳐누리 회의 참여, UnderDocs 피드백 ppt 정리 및 피드백 정리 양식 공유, 일주일 사용자 로그 보고, 관련기사 api 관련 이슈 해결

<br>

### 11.22 토
- [X] 백엔드 개발 계속 진행

### 11.23 일
- [X] 백엔드 개발 계속 진행
